version: 2
jobs:
  build-and-test:
    docker:
      - image: mcr.microsoft.com/dotnet/sdk:5.0
    steps:
      - checkout
      - run:
          name: Build
          command:
            dotnet build
      - run:
          name: Test
          command:
            dotnet test --logger "junit;LogFilePath=test-results/results.xml"
  publish-test-results:
    name: "Publish Unit Tests Results"
    needs: build-and-test
    executor: ubuntu-latest  
    steps:
      - run:
          name: Publish Unit Test Results
          uses: EnricoMi/publish-unit-test-result-action@v1.6
          with:
            check_name: Unit Test Results
            github_token: ${{ secrets.GITHUB_TOKEN }}
            files: test-results/*.xml